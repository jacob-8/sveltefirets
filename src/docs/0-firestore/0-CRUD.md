# Create, Read, Update, Delete

## Create using `add` helper method

`add` has the same behavior as Firestore's `addDoc` method but simplifies the setup by automatically creating a collection reference from a path string. It also adds 4 metadata fields: `createdAt`, `createdBy`, `updatedAt`, `updatedBy`.

```ts
import { add } from 'sveltefirets';
import type { Message } from '$lib/message.interface';
function sayHello(name: string) {
  add<Message>('messages', { text: 'Hello from ' + name });
}
```

Say hello to add your greeting to the list of greetings (seen in the next section):

TODO - add back in here (see below)

## List (Collection), Update, Delete

The easiest way to list data is to use the `<Collection />` component which operates very similarly to the original [Sveltefire one](https://github.com/codediodeio/sveltefire#collection) with the addition of the `traceId`, `log`, `maxWait`, `once`, `refField` props being reactive as can be seen in the example below.

TODO - add back in here (see below)

The `<Collection />` component works asynchronously and so can't handle SSR loading. That can only be done in a page load file, but you should consider pairing the `<Collection />` component with the isomorphic (client/server) `getCollection()` method discussed in [[1-load-data-in-load-function]] for a SSR + realtime-updating client side experience. Just pass the data retrieved on page load into the `startWith` prop of the `<Collection />` and everything will just work. It will also provide with you type completion assuming that you've properly typed your data fetched using `getCollection()`.

After reading [[1-load-data-in-load-function#Load Document]], feel free to test out page loaded data for the above messages using the following links:

- <a href={`/demo/messages`}>Hover to preload firestore data for all messages on client (see console log)</a>
- <a href={`/demo/messages`} target="_blank">Load firestore data for all messages server-side (opens new tab)</a>
- <a href={`/demo/api/messages`} target="_blank">Messages API endpoint</a>

## Update

Did you try the `Update` buttons in the list above? Similar to the `add` method, `update` has the same behavior as Firestore's `updateDoc` method but simplifies the setup by automatically creating a document reference from a path string. It will leave alone the `createdAt` and `createdBy` fields and just update the `updatedAt` and `updatedBy` fields. Here's the code for that:

```ts
import { update } from 'sveltefirets';
import type { Message } from '$lib/message.interface';
function updateName(id: string, name: string) {
  update<Message>(`messages/${id}`, { text: 'Hello from ' + name });
}
```

## Delete

Did you try the `Delete` buttons in the list above? (Go easy so others have samples to view). Here's the code for that:

```ts
import { deleteDocument } from 'sveltefirets';
function deleteGreeting(id: string) {
  deleteDocument(`messages/${id}`);
}
```

## Read (Document)

Same as using the `<Collection />` component, the easiest way to show live data for a document is to use the `<Doc />` component which operates very similarly to the original [Sveltefire one](https://github.com/codediodeio/sveltefire#doc) with the addition of the `traceId`, `log`, `maxWait`, `once` props being reactive. Go ahead and update the id (in the controls to the right), pulling from the list above.


<Story showCode name="read" knobs={{id: 'testMessage'}} let:props={{id}}>
  <Doc path="messages/{id}" let:data={message}>
    <Button href="/demo/message/{message.id}">Preload firestore data on client</Button>
    <Button href="/demo/message/{message.id}" target="_blank">Load firestore data server-side</Button>
    <Button href="/demo/api/{message.id}" target="_blank">Message API endpoint</Button>
    <pre>{JSON.stringify(message, null, 2)}</pre>
    <div slot="fallback">
      No document found with this id. Choose an ID from the above list of greetings.
    </div>
  </Doc>
</Story>

## Set

`set` operates a little different than Firebase's `setDoc` method. It will first check if the document you are setting already exists. If so, it will use the `update` method. If not, it will use `setDoc` but with the same 4 metadata additions added by the `add` method described above.

```ts
import { set } from 'sveltefirets';
import type { Message } from '$lib/message.interface';
function setName(id: string, name: string) {
  set<Message>(`messages/${id}`, { text: 'Hello from ' + name });
}
```

There may be a case for renaming this as `upsert` in the future and creating a new `set` method that more closely resembles the Firebase `setDoc`.

[//begin]: # "Autogenerated link references for markdown compatibility"
[1-load-data-in-load-function]: 1-load-data-in-load-function.md "Load Data in Load function"
[1-load-data-in-load-function#Load Document]: 1-load-data-in-load-function.md "Load Data in Load function"
[//end]: # "Autogenerated link references"